{% extends "layout.html" %}
{% block footer %}Sujet n°{{ topic.Id }} - {% endblock %}
{% block title %}Sujet n°{{ topic.Id }} - {% endblock %}
{% block head %}
	{{ super() }}
	<script>
        $SCRIPT_ROOT = location.protocol+'//'+location.hostname+(location.port ?  ':'+location.port: '');

		$(function() {
			getScoreColor($('#score'));

		    $('[data-toggle="tooltip"]').tooltip()
			
			$('#pouroucontre').click(function(e) {
				var target = $(e.target);
				if(target.is('#pour')) {
					$("input[name='group1']").val('Pour')
				} else if(target.is('#contre')) {
					$("input[name='group1']").val('Contre')
				}
			});

			$('.ptn-poll').click(function(e) {
				var target = $(e.target);

				if(target.is('#plus-one')) {
					value = 1;
				} else if(target.is('#minus-one')) {
					value = -1;
				} else {
					value = 0;
				}
				$.getJSON($SCRIPT_ROOT + '/_update_topic_score/'
					, { value: value, topic_id: $('#topic_id').val() }
				  	, function(data) {
				  		$("#score").text(data.result);
				  		getScoreColor($('#score'));
				});
			});
		});
	</script>
{% endblock %}
{% block content %}
	<h1 class="">{{ topic.Question }}</h1>
	<hr/>
	<div class="row">
		<div class="col-sm-6" id="list-comment-positive">
				{% for answer in answersPro %}
					{% if answer.IsExpert == True %}
						<div class="alert alert-success">{{ answer.Answer }}</div>
					{% else %}
						<div class="alert alert-success"><span class="glyphicon glyphicon-star"></span> {{ answer.Answer }}</div>
					{% endif %}
				{% endfor %}
		</div>
		<div class="col-sm-6" id="list-comment-negative">
			{% for answer in answersContre %}
					{% if answer.IsExpert == True %}
						<div class="alert alert-danger">{{ answer.Answer }}</div>
					{% else %}
						<div class="alert alert-danger">{{ answer.Answer }} <span class="glyphicon glyphicon-star"></span></div>
					{% endif %}
			{% endfor %}
		</div>
	</div>
	<hr/>
	<div class="text-center">
	    <div class="text-center answer">
	      <span id="score" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Résultat des votes">{{ topic.Score }}</span>
				{% if session['logged_in'] %}
				    <div class="text-center">
				    	<span id="plus-one" class="btn btn-success ptn-poll">+</span>
				    	<span href="#" id="minus-one" class="btn btn-danger ptn-poll">-</span>
				    </div>
				{% endif %}
	    </div>
	    <hr/>
	</div>
{% if session['logged_in'] %}
  	<input id="topic_id" type="hidden" value="{{ topic.Id }}"/>
    <form action="{{ url_for('add_comment', question_id=topic.Id) }}"  id="comment-form" method=post>
        <fieldset class="answer">
        	<fieldset id="pouroucontre">
		    	<span href="#" id="pour" class="btn btn-success">Pour <span class="glyphicon glyphicon-thumbs-up"></span> </span>
		    	<span id="contre" class="btn btn-danger"><span class="glyphicon glyphicon-thumbs-down"></span> Contre</span>
		    </fieldset>
	        <br/>
	        <textarea placeholder="Veuillez entrer un commentaire" name=answer rows=2 cols=40></textarea>
        </fieldset>
        <hr/>
        <input name="group1" type="hidden" value="Pour"/>
      	<div class = "text-center">
        	<input class="btn btn-success" type=submit value=Envoyer>
        	<a href="{{ url_for('index') }}" class="btn btn-danger">Retour</a>
      </div>
    </form>
{% endif %}
{% endblock %}
